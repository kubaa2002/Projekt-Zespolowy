import React, { useState } from 'react';
import './Post.scss';

import Hidden from './Hidden';
import UserTag from './UserTag';
import axios from 'axios';
import { useAuth } from '../../contexts/authProvider';

const Post = ({ post }) => {
  const { id, authorId, content, createdDateTime, isLied } = post;
  const [liked, setLiked] = useState(isLied);
  const [saved, setSaved] = useState(false);
  const [showReplies, setShowReplies] = useState(false);
  const { token } = useAuth();

 
  const getAuthConfig = () => ({
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });


  const handleLike = async () => {
    const reactionType = liked ? 3 : 1; 
    try {
      const response = await axios.post(
        `${import.meta.env.VITE_API_URL}/posts/${id}/Like`,
        { reactionType },
        getAuthConfig()
      );
      console.log('Reaction processed:', response.data);
      setLiked(!liked); // Toggle local state
    } catch (err) {
      console.error('Error processing reaction:', err);
    }
  };

  const isLong = false;
  const previewText = isLong ? content.slice(0, 300) + '...' : content;

  return (
    <div>
      <div className="post-container">
        <UserTag post={post} />

        <div className="post-content">
          <div dangerouslySetInnerHTML={{ __html: previewText }} />
          {isLong && <a href="#" className="read-more">...czytaj dalej</a>}
        </div>

        <div className="post-actions">
          <div>
            <label className={`icon-checkbox ${liked ? 'active' : ''}`}>
              <input
                type="checkbox"
                checked={liked}
                onChange={handleLike} 
              />
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="red"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.9999 4.12207L10.9244 3.01657C8.39995 0.421573 3.77095 1.31707 2.09995 4.57957C1.31545 6.11407 1.13845 8.32957 2.57095 11.1571C3.95095 13.8796 6.82195 17.1406 11.9999 20.6926C17.1779 17.1406 20.0474 13.8796 21.4289 11.1571C22.8614 8.32807 22.6859 6.11407 21.8999 4.57957C20.2289 1.31707 15.5999 0.420073 13.0754 3.01507L11.9999 4.12207ZM11.9999 22.5001C-10.9995 7.30207 4.91845 -4.55993 11.7359 1.71457C11.8259 1.79707 11.9144 1.88257 11.9999 1.97107C12.0846 1.88265 12.1726 1.79759 12.2639 1.71607C19.0799 -4.56293 34.9994 7.30057 11.9999 22.5001Z"
                  fill="red"
                />
              </svg>
              Like
            </label>
            <label
              onClick={() => setShowReplies((p) => !p)}
              className="icon-checkbox"
            >
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M4.017 17.841C4.1727 17.9973 4.292 18.186 4.36641 18.3937C4.44082 18.6014 4.46851 18.8229 4.4475 19.0425C4.34208 20.0589 4.14221 21.0632 3.8505 22.0425C5.943 21.558 7.221 20.997 7.8015 20.703C8.13076 20.5362 8.50993 20.4967 8.8665 20.592C9.88865 20.8645 10.9421 21.0017 12 21C17.994 21 22.5 16.7895 22.5 12C22.5 7.212 17.994 3 12 3C6.006 3 1.5 7.212 1.5 12C1.5 14.202 2.4255 16.245 4.017 17.841ZM3.2775 23.6985C2.9221 23.769 2.56555 23.8335 2.208 23.892C1.908 23.94 1.68 23.628 1.7985 23.349C1.93169 23.0349 2.05376 22.7162 2.1645 22.3935L2.169 22.3785C2.541 21.2985 2.844 20.0565 2.955 18.9C1.1145 17.055 0 14.64 0 12C0 6.201 5.373 1.5 12 1.5C18.627 1.5 24 6.201 24 12C24 17.799 18.627 22.5 12 22.5C10.8115 22.5016 9.62788 22.3473 8.4795 22.041C7.6995 22.4355 6.021 23.154 3.2775 23.6985Z"
                  fill="black"
                />
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M6 8.25C6 8.05109 6.07902 7.86032 6.21967 7.71967C6.36032 7.57902 6.55109 7.5 6.75 7.5H17.25C17.4489 7.5 17.6397 7.57902 17.7803 7.71967C17.921 7.86032 18 8.05109 18 8.25C18 8.44891 17.921 8.63968 17.7803 8.78033C17.6397 8.92098 17.4489 9 17.25 9H6.75C6.55109 9 6.36032 8.92098 6.21967 8.78033C6.07902 8.63968 6 8.44891 6 8.25ZM6 12C6 11.8011 6.07902 11.6103 6.21967 11.4697C6.36032 11.329 6.55109 11.25 6.75 11.25H17.25C17.4489 11.25 17.6397 11.329 17.7803 11.4697C17.921 11.6103 18 11.8011 18 12C18 12.1989 17.921 12.3897 17.7803 12.5303C17.6397 12.671 17.4489 12.75 17.25 12.75H6.75C6.55109 12.75 6.36032 12.671 6.21967 12.5303C6.07902 12.3897 6 12.1989 6 12ZM6 15.75C6 15.5511 6.07902 15.3603 6.21967 15.2197C6.36032 15.079 6.55109 15 6.75 15H12.75C12.9489 15 13.1397 15.079 13.2803 15.2197C13.421 15.3603 13.5 15.5511 13.5 15.75C13.5 15.9489 13.421 16.1397 13.2803 16.2803C13.1397 16.421 12.9489 16.5 12.75 16.5H6.75C6.55109 16.5 6.36032 16.421 6.21967 16.2803C6.07902 16.1397 6 15.9489 6 15.75Z"
                  fill="black"
                />
              </svg>
              Komentarze
            </label>
            <label className={`icon-checkbox ${saved ? 'active' : ''}`}>
              <input
                type="checkbox"
                checked={saved}
                onChange={() => setSaved(!saved)}
              />
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3 3C3 2.20435 3.31607 1.44129 3.87868 0.87868C4.44129 0.316071 5.20435 0 6 0L18 0C18.7956 0 19.5587 0.316071 20.1213 0.87868C20.6839 1.44129 21 2.20435 21 3V23.25C20.9999 23.3857 20.9631 23.5188 20.8933 23.6351C20.8236 23.7515 20.7236 23.8468 20.604 23.9108C20.4844 23.9748 20.3497 24.0052 20.2142 23.9988C20.0787 23.9923 19.9474 23.9492 19.8345 23.874L12 19.6515L4.1655 23.874C4.05256 23.9492 3.92135 23.9923 3.78584 23.9988C3.65033 24.0052 3.5156 23.9748 3.396 23.9108C3.2764 23.8468 3.17641 23.7515 3.10667 23.6351C3.03694 23.5188 3.00007 23.3857 3 23.25V3ZM6 1.5C5.60218 1.5 5.22064 1.65804 4.93934 1.93934C4.65804 2.22064 4.5 2.60218 4.5 3V21.849L11.5845 18.126C11.7076 18.0441 11.8521 18.0004 12 18.0004C12.1479 18.0004 12.2924 18.0441 12.4155 18.126L19.5 21.849V3C19.5 2.60218 19.342 2.22064 19.0607 1.93934C18.7794 1.65804 18.3978 1.5 18 1.5H6Z"
                  fill="red"
                />
              </svg>
              Zapisz
            </label>
          </div>
          <label className="icon-checkbox">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clipPath="url(#clip0_253_41801)">
                <path
                  d="M20.2502 1.50047C19.6534 1.50047 19.0811 1.73752 18.6592 2.15948C18.2372 2.58144 18.0002 3.15373 18.0002 3.75047C18.0002 4.34721 18.2372 4.9195 18.6592 5.34146C19.0811 5.76342 19.6534 6.00047 20.2502 6.00047C20.8469 6.00047 21.4192 5.76342 21.8411 5.34146C22.2631 4.9195 22.5002 4.34721 22.5002 3.75047C22.5002 3.15373 22.2631 2.58144 21.8411 2.15948C21.4192 1.73752 20.8469 1.50047 20.2502 1.50047ZM16.5002 3.75047C16.5 2.87062 16.8093 2.01874 17.3739 1.34389C17.9384 0.669031 18.7223 0.214166 19.5883 0.0588767C20.4543 -0.0964129 21.3474 0.0577611 22.1112 0.494425C22.8751 0.931088 23.4611 1.62243 23.7667 2.44751C24.0723 3.27258 24.078 4.17884 23.7829 5.00773C23.4879 5.83662 22.9107 6.53535 22.1525 6.98169C21.3942 7.42802 20.5032 7.59352 19.6352 7.44925C18.7673 7.30497 17.9777 6.8601 17.4047 6.19247L7.32765 10.8725C7.55932 11.6066 7.55932 12.3943 7.32765 13.1285L17.4047 17.8085C18.0104 17.104 18.8561 16.6494 19.7779 16.5329C20.6997 16.4165 21.632 16.6463 22.3939 17.178C23.1559 17.7097 23.6934 18.5053 23.9022 19.4107C24.1109 20.316 23.9762 21.2667 23.524 22.0783C23.0719 22.89 22.3345 23.5049 21.4548 23.8039C20.5751 24.1029 19.6157 24.0646 18.7626 23.6966C17.9095 23.3285 17.2233 22.6569 16.8372 21.8118C16.4511 20.9667 16.3925 20.0083 16.6727 19.1225L6.59565 14.4425C6.09681 15.0238 5.43188 15.4385 4.69032 15.6306C3.94876 15.8227 3.16615 15.7832 2.44776 15.5172C1.72937 15.2512 1.10967 14.7716 0.672015 14.1429C0.234362 13.5142 -0.000244141 12.7665 -0.000244141 12.0005C-0.000244141 11.2344 0.234362 10.4868 0.672015 9.85804C1.10967 9.22932 1.72937 8.74972 2.44776 8.48375C3.16615 8.21778 3.94876 8.17821 4.69032 8.37034C5.43188 8.56248 6.09681 8.97712 6.59565 9.55847L16.6727 4.87847C16.5579 4.51347 16.4998 4.13307 16.5002 3.75047ZM3.75015 9.75047C3.15342 9.75047 2.58112 9.98752 2.15916 10.4095C1.73721 10.8314 1.50015 11.4037 1.50015 12.0005C1.50015 12.5972 1.73721 13.1695 2.15916 13.5915C2.58112 14.0134 3.15342 14.2505 3.75015 14.2505C4.34689 14.2505 4.91919 14.0134 5.34114 13.5915C5.7631 13.1695 6.00015 12.5972 6.00015 12.0005C6.00015 11.4037 5.7631 10.8314 5.34114 10.4095C4.91919 9.98752 4.34689 9.75047 3.75015 9.75047ZM20.2502 18.0005C19.6534 18.0005 19.0811 18.2375 18.6592 18.6595C18.2372 19.0814 18.0002 19.6537 18.0002 20.2505C18.0002 20.8472 18.2372 21.4195 18.6592 21.8415C19.0811 22.2634 19.6534 22.5005 20.2502 22.5005C20.8469 22.5005 21.4192 22.2634 21.8411 21.8415C22.2631 21.4195 22.5002 20.8472 22.5002 20.2505C22.5002 19.6537 22.2631 19.0814 21.8411 18.6595C21.4192 18.2375 20.8469 18.0005 20.2502 18.0005Z"
                  fill="black"
                />
              </g>
              <defs>
                <clipPath id="clip0_253_41801">
                  <rect width="24" height="24" fill="white" />
                </clipPath>
              </defs>
            </svg>
            Share
          </label>
        </div>
      </div>
      {showReplies && <Hidden id={id} />}
    </div>
  );
};

export default Post;